{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\n\nvar _s = $RefreshSig$(),\n    _jsxFileName = \"C:\\\\Users\\\\KGM\\\\OneDrive\\\\Documents\\\\GitHub\\\\chec\\\\fyp\\\\lib\\\\user.js\";\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport axios from 'axios';\nexport async function fetchUser(cookie = '') {\n  if (true && window.__user) {\n    return window.__user;\n  }\n\n  const res2 = await authAPI.get(\"/api/me\").then(cookie => {\n    if (cookie) {\n      return {\n        headers: {\n          cookie\n        }\n      };\n    } else {\n      return {};\n    }\n  }).catch(error => {\n    console.error(error);\n    return {};\n  });\n  const res = await fetch('/api/me', cookie ? {\n    headers: {\n      cookie\n    }\n  } : {});\n\n  if (!res.ok) {\n    delete window.__user;\n    return null;\n  }\n\n  const json = await res.json();\n\n  if (true) {\n    window.__user = json;\n  }\n\n  return json;\n}\nexport function useFetchUser({\n  required\n} = {}) {\n  _s();\n\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(() => !(true && window.__user));\n  const {\n    0: user,\n    1: setUser\n  } = useState(() => {\n    if (false) {\n      return null;\n    }\n\n    return window.__user || null;\n  });\n  useEffect(() => {\n    if (!loading && user) {\n      return;\n    }\n\n    setLoading(true);\n    let isMounted = true;\n    fetchUser().then(user => {\n      // Only set the user if the component is still mounted\n      if (isMounted) {\n        // When the user is not logged in but login is required\n        if (required && !user) {\n          window.location.href = '/api/login';\n          return;\n        }\n\n        setUser(user);\n        setLoading(false);\n      }\n    });\n    return () => {\n      isMounted = false;\n    };\n  }, // eslint-disable-next-line react-hooks/exhaustive-deps\n  []);\n  return {\n    user,\n    loading\n  };\n}\n\n_s(useFetchUser, \"R3qHXfB0UuWddS8mq6/SAvKUmBk=\");\n\nexport function withUseFetchUser(Component) {\n  var _s2 = $RefreshSig$();\n\n  return _s2(function WrappedComponent(props) {\n    _s2();\n\n    const myHookValue = useFetchUser();\n    return __jsx(Component, _extends({}, props, {\n      useFetchUser: myHookValue,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 12\n      }\n    }));\n  }, \"D/RKZlqA8tlqy8NnS1U4AY/0ZTI=\", false, function () {\n    return [useFetchUser];\n  });\n}","map":{"version":3,"sources":["C:/Users/KGM/OneDrive/Documents/GitHub/chec/fyp/lib/user.js"],"names":["useState","useEffect","axios","fetchUser","cookie","window","__user","res2","authAPI","get","then","headers","catch","error","console","res","fetch","ok","json","useFetchUser","required","loading","setLoading","user","setUser","isMounted","location","href","withUseFetchUser","Component","WrappedComponent","props","myHookValue"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\r\nimport axios from 'axios';\r\n\r\nexport async function fetchUser(cookie = '') {\r\n  if (typeof window !== 'undefined' && window.__user) {\r\n    return window.__user\r\n  }\r\n\r\n  const res2 = await authAPI.get(\"/api/me\").then(cookie => {\r\n    if (cookie) {\r\n      return {\r\n        headers: {\r\n          cookie,\r\n        }\r\n      }\r\n    } else {\r\n      return {}\r\n    }\r\n  }).catch(error => {\r\n    console.error(error);\r\n    return {};\r\n  });\r\n\r\n  const res = await fetch(\r\n    '/api/me',\r\n    cookie\r\n      ? {\r\n        headers: {\r\n          cookie,\r\n        },\r\n      }\r\n      : {}\r\n  )\r\n\r\n  if (!res.ok) {\r\n    delete window.__user\r\n    return null\r\n  }\r\n\r\n  const json = await res.json()\r\n  if (typeof window !== 'undefined') {\r\n    window.__user = json\r\n  }\r\n  return json\r\n}\r\n\r\nexport function useFetchUser({ required } = {}) {\r\n  const [loading, setLoading] = useState(\r\n    () => !(typeof window !== 'undefined' && window.__user)\r\n  )\r\n  const [user, setUser] = useState(() => {\r\n    if (typeof window === 'undefined') {\r\n      return null\r\n    }\r\n\r\n    return window.__user || null\r\n  })\r\n\r\n  useEffect(\r\n    () => {\r\n      if (!loading && user) {\r\n        return\r\n      }\r\n      setLoading(true)\r\n      let isMounted = true\r\n\r\n      fetchUser().then((user) => {\r\n        // Only set the user if the component is still mounted\r\n        if (isMounted) {\r\n          // When the user is not logged in but login is required\r\n          if (required && !user) {\r\n            window.location.href = '/api/login'\r\n            return\r\n          }\r\n          setUser(user)\r\n          setLoading(false)\r\n        }\r\n      })\r\n\r\n      return () => {\r\n        isMounted = false\r\n      }\r\n    },\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    []\r\n  )\r\n\r\n  return { user, loading }\r\n}\r\n\r\nexport function withUseFetchUser(Component) {\r\n  return function WrappedComponent(props) {\r\n    const myHookValue = useFetchUser();\r\n    return <Component {...props} useFetchUser={myHookValue} />;\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}